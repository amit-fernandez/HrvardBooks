# Project 1 - ABC Books

In this project, I have created a website "ABC Books" where a user can register, login and write review for the books.
I have used bootstrap, Python, Jinja and Postgres

### Postgres Tables [Create Queries](CreateTables.sql)

#### userdetails
This is used to store the User profile Information

* loginid	| Integer| Autogenerated **Primary** key for the table
* firstname |varchar |First name of the user
* lastname |varchar | Last name of the user
* username | varchar | User Id for Login (Also has **UNIQUE** constraint to have only one entry in the table)
* email | varchar | Stores email of the user
 * createddate |timestamp| time of the user creation

#### usercred
This is a separate table to store the password. Its done that way to that we can addition additional encryption for this.

* loginid	|integer | **Foreign** key to the userdetails table
* password |varchar | Password for login
* createddate	|timestamp| time of password creation

#### bookdetails
This table is used to store the book details
* bookid	|Integer|Autogenerated **primary** key of the book.
* isbn	| varchar | Isbn from books.csv
* title	|varchar | title of the book
* author  |varchar |Author of the book
* year	| varchar | Year of publication

#### bookreviews
This table is used to store the reviews for each book

* reviewid |integer| Autogenerated **Primary** key
* username|varchar| **Foreign key** to userdetails. **Unique key** along with isbn
* isbn|varchar |**Foreign key** to bookdetails. **Unique key** along with username		
* rating|integer| Rating of the book
* comments|varchar | comments of the book
* createddate|timestamp | time the comments was generated

### Webpage details [Gif of the application](abc_books.gif)

#### Layout
* This holds the static header image for the website

#### Login
* This is the default page of the application.
* When the user clicks Login, it calls the Login route in application.py
* The app first checks if the user name is present in the userdetails table and then checks if the password is in the usercred table
* If any of them doesnt match it throws the error "Username and password does not match"
* If the credentials match, the app renders search.html
* The app also stores the user's first name and user name in the session
* username is marked as UNIQUE to avoid duplicate entries


#### Registration
* If the username is not created, the agent can use this page to create one
* Along with the username and password, he needs to enter first name, last name and email
* All the fields are mandatory and the validation is handled through bootstrap `required
` class
* The application first checks if there are any existing row with the same user name before accepting the data
* The data is inserted into `userdetails` and `usercred` tables
* On successful registration, it redirects back to Login page

#### Import books
* bookdetails table is created
* using the books.csv, the books are inserted into the table.
* The code is in `import.py`

#### Search
* The page displays the user name and the Logout link. User name is retrieved from the session
* It allows to search by ISBN/Title/Author. The search is an OR operation between them
* It does a case insesitive search using `ILIKE` operation
* When the user searches, it does a post to seach route in application.py
* The app fetches the data from `bookdetails` table
* I used ` covers.openlibrary.org` to get the images of the book
* I used `{%if%}/{%elif%}/{%else%}` to display appropriate messages if the search fails.
* When the user clicks on the book, it will redirect to corresponding book.html
* Used bootstarp cards to implement the section and bootstrap table for the results
* Used `alert macro` to display edit messages
* Used function to create the SQL statement

#### Book
* Book/isbn is passed to load the book page
* This has data from various sections
	* Book Information from bookdetails table
	* Reviews written by the user for the book
	* Reviews written by others for the book
	* Good Read rating and reviewers count
	* ABC books ratings and reviewers count
	* Section to enter rating and review is not submitted before
* Used `bootstrap card` to display various sections
* Used `badges` to display the average review and ratings
* Used fontawesome `star` icon to implement the rating
* On the review section I used different border colors based on the review comments- greater than 3  - green, less than 3 is red
* When rating and/or review is entered and saved, the data is stored in the bookreviews table
* When the user has already entered a review, he will not see options to submit another. This is also handled with the `UNIQUE` key of username,isbn
* Validations and alerts on the page
	* When the user enters the review without the rating, alert message is thrown
	* When there are no reviews on the book, a separate message is displayed
	* When the user is the only review, a separate message is displayed
* For all operations that involves the username, the info is pulled from the session

#### Book Api
* The data is pulled from bookdetails and book review pages to create the content
* `jsonify` needs to be used to create a json response
* It gives a 404 with a "Book not found" error if the isbn number doesnt match


## Details to run the app

* Database details - postgres://ogtbllwtdnobgv:eb5c22eab593a69628b9c6a6617576d9b0f6d088c2d4d0bb8d2c9ed40247a989@ec2-50-17-193-83.compute-1.amazonaws.com:5432/dab2418df67c5d
* Some of the username/password that can be used cedric/cedric, celine/celine, john/john
* All books with Title as "wood" has some comments already entered
* Requirements.txt is updated with jsonify as I had to install that to use it on my api
